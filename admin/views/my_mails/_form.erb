<div class="col-xs-12">
    <% error = @my_mail.errors.include?(:title) %>
    <fieldset class="control-group <%= error ? 'has-error' : '' %>">

      <div class="dropdown">
        <a href="#" class="list-menu-toggle dropdown-toggle" data-toggle="dropdown">
          <%= tag_icon :magic %> <span class="caret"></span>
        </a>
        <ul class="list-menu dropdown-menu" role="menu">
          <li class="list-menu-wrapper">
            <%= link_to tag_icon('check-square-o', pat(:select_all)), '#', :id => 'select-all-emails', :onclick => 'select_all_emails();', :class => 'list-menu-link' %>
          </li>
          <li class="list-menu-wrapper.list-menu-wrapper-disabled">
            <%= link_to tag_icon('square-o', pat(:remove_all)), '#', :id => 'remove-all-emails', :onclick => 'remove_all_emails();', :class => 'list-menu-link' %>
          </li>
        </ul>
      </div>

        <%= f.label :to_emails, :class => 'control-label' %>
        <div class="controls">
            <%= f.text_field :to_emails, :value => @my_mail.to_emails.join('; '), :class => 'form-control input-xlarge input-with-feedback' %>
            <span class="help-inline"><%= error ? f.error_message_on(:to_emails) : '发送给多人时地址请以分号 ; 隔开' %></span>
        </div>
    </fieldset>
</div>

<div class="col-xs-12">
    <% error = @my_mail.errors.include?(:title) %>
    <fieldset class='control-group <%= error ? 'has-error' : ''%>'>
        <%= f.label :title, :class => 'control-label' %>
        <div class='controls'>
            <%= f.text_field :title, :required => true, :class => 'form-control input-xlarge input-with-feedback' %>
            <span class='help-inline'><%= error ? f.error_message_on(:title) : '' %></span>
        </div>
    </fieldset>
</div>

<div class="col-xs-12">
    <% error = @my_mail.errors.include?(:content) %>
    <fieldset class="control-group <%= error ? 'has-error' : ''%>">
        <%= f.label :content, :class => 'control-label' %>
        <div class="controls">
          <%= f.text_area :content, :class => 'ckeditor form-control input-xlarge input-with-feedback' %>
          <span class='help-inline'><%= error ? f.error_message_on(:content) : '' %></span>
        </div>
    </fieldset>
</div>
<div class="clearfix"></div>

<div class="form-actions modal-footer">
    <% if @my_mail.can_edit? %>
        <%= f.submit pat(:save_draft), :class => 'btn btn-primary' %>
        &nbsp;
        <%= f.submit pat(:save_and_send), :class => 'btn btn-info', :name => 'save_and_send' %>
        &nbsp;
    <% end %>
    <%= link_to pat(:cancel), url(:my_mails, :index), :class => 'btn btn-default' %>
</div>

<%= javascript_include_tag 'ckeditor/ckeditor' %>

<script>
    function select_all_emails(){
        var emails = get_all_emails();
        $('#my_mail_to_emails').val(emails.join('; '));
        $('#select-all-emails').addClass('list-menu-link-disabled');
        $('#remove-all-emails').removeClass('list-menu-link-disabled');
    }
    function remove_all_emails(){
        $('#my_mail_to_emails').val('');
        $('#select-all-emails').removeClass('list-menu-link-disabled');
        $('#remove-all-emails').addClass('list-menu-link-disabled');
    }
    function get_all_emails(){
        var result = [];
        $.ajax({
            type: 'GET',
            dataType: 'json',
            async: false,
            url: '/admin/customers/get_all_emails',
            success: function(data){
                if(data.status == 'succ'){
                    result = data.emails;
                }else{
                    alert(data.reason);
                }
            }
        });
        return result
    }
</script>